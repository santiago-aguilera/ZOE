{% extends "Layout.html" %}
{% block content %}

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<style>
  :root {
    --azul-oscuro: #003f6b;
    --azul-medio: #4d82bc;
    --azul-claro: #dceeff;
    --blanco: #ffffff;
    --rojo: #d9534f;
    --amarillo: #f0ad4e;
  }

  body {
    background-color: #eef2ff;
    font-family: "Poppins", sans-serif;

  }

  h1 {
    color: var(--azul-oscuro);
    margin-bottom: 1.5rem;
    text-align: center;
    font-size: 2rem;
  }
  .contenedor-cronograma {
    display: flex;
    gap: 2rem;
    width: 95%;
    margin: 2rem auto;
  }

  .panel-eventos {
    width: 40%;
    background: var(--blanco);
    padding: 1.5rem;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .panel-eventos h2 {
    text-align: center;
    margin-bottom: 1rem;
    color: var(--azul-oscuro);
  }

  .btn-crear {
    display: block;
    width: 100%;
    background-color: var(--azul-medio);
    color: var(--blanco);
    padding: 0.8rem;
    border-radius: 10px;
    text-align: center;
    font-weight: 600;
    margin-bottom: 1.5rem;
    text-decoration: none;
  }

  .btn-crear:hover {
    background-color: var(--azul-oscuro);
  }

  .evento {
    background-color: var(--azul-claro);
    padding: 1rem;
    border-radius: 10px;
    margin-bottom: 1rem;
  }

  .botones-evento {
    margin-top: 0.8rem;
    display: flex;
    gap: 0.5rem;
  }

  .btn-editar {
    background-color: var(--amarillo);
    color: var(--blanco);
    padding: 0.4rem 0.8rem;
    border-radius: 6px;
    font-weight: 600;
    border: none;
    cursor: pointer;
  }

  .btn-eliminar {
    background-color: var(--rojo);
    color: var(--blanco);
    padding: 0.4rem 0.8rem;
    border-radius: 6px;
    font-weight: 600;
    border: none;
    cursor: pointer;
  }

  /* Contenedor del calendario */
  #calendar {
    width: 60%;
    background: var(--blanco);
    padding: 1rem;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    min-height: 650px;
  }
  
.fc {
  font-family: inherit;
}

.fc table {
  border-collapse: collapse;
}

.fc td, .fc th {
  padding: 0;
}

</style>

<div class="contenedor-cronograma">

  <!-- Panel izquierdo -->
  <div class="panel-eventos">
    <h1>Cronograma general</h1>

    <a href="/eventos" class="btn-crear">+ Crear nuevo evento</a>

    {% for e in eventos %}
    <div class="evento">
      <strong>{{ e.Titulo }}</strong>
      <em>{{ e.Fecha }} — {{ e.Hora }}</em>
      <p>{{ e.Descripcion }}</p>
      <p><strong>Materia:</strong> {{ e.nombre_materia }}</p>
      <p><strong>Tipo:</strong> {{ e.Tipo }}</p>
      <p><strong>Lugar:</strong> {{ e.Lugar }}</p>

      <div class="botones-evento">
        <a href="/editar-evento/{{ e.Id_Cronograma }}">
          <button class="btn-editar" type="button">Editar</button>
        </a>

        <a href="/eliminar-evento/{{ e.Id_Cronograma }}"
          onclick="return confirm('¿Seguro que deseas eliminar este evento?')">
          <button class="btn-eliminar" type="button">Eliminar</button>
        </a>
      </div>
    </div>
    {% endfor %}

    {% if eventos|length == 0 %}
    <p>No hay eventos programados.</p>
    {% endif %}
  </div>

  <!-- Panel derecho: calendario -->
  <div id="calendar" data-events='{{ eventos_json|tojson|safe }}'></div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');

    var eventsData = calendarEl.getAttribute('data-events');
    var events = [];

    try {
        events = JSON.parse(eventsData);
    } catch (e) {
        console.error("Error parseando eventos:", e);
    }

    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: events,
        height: 650,
        locale: 'es',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek'
        }
    });

    calendar.render();
});
</script>

{% endblock %}